cloud db

# set env

mkdir -p /etc/mysql/conf.d
sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config
setenforce 0
#set ssh
sed -i -e 's/^GSSAPIAuthentication yes$/GSSAPIAuthentication no/' -e 's/#UseDNS yes/UseDNS no/' /etc/ssh/sshd_config

sed -i 's/#UseDNS yes/UseDNS no/' /etc/ssh/sshd_config

service sshd restart

#set the file limit

vi /etc/security/limits.d/mysql.conf
mysql        soft    nproc           102400
mysql        hard    nproc           102400
root        soft    nproc           102400
root        hard    nproc           102400
mysql        soft   nofile           102400
mysql        hard   nofile           102400
root        soft    nofile           102400
root        hard    nofile           102400

{if cat /etc/rc.local | grep "ulimit -SHn 102400" > /dev/null;then
	echo ""
else
	echo "ulimit -SHn 102400" >> /etc/rc.local
fi

if cat /etc/security/limits.conf | grep "* soft nofile 65535" > /dev/null;then
echo ""
else
echo "* soft nofile 65535" >> /etc/security/limits.conf
fi

if cat /etc/security/limits.conf | grep "* hard nofile 65535" > /dev/null ;then
echo ""
else
echo "* hard nofile 65535" >> /etc/security/limits.conf
fi
}

#yum

sed -i '11i proxy=http://10.154.88.88:3128' /etc/yum.conf

#编译mysqldumper用到
yum -y install pcre-devel

#mysql 用户创建
groupadd mysql && useradd -r -g mysql mysql

{#去掉不必要的服务
chkconfig bluetooth off
yum remove bluetooth

chkconfig cups off
yum remove cups -y
yum remove cpuspeed -y}




yum -y install gcc gcc-c++ autoconf libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel glib2 glib2-devel bzip2 bzip2-devel ncurses ncurses-devel curl curl-devel e2fsprogs e2fsprogs-devel krb5 krb5-devel libidn libidn-devel openssl openssl-devel bison cmake

# set env end

#编译mysql

tar xvf mysql-mysql-5.5.35.t15.tar ; cd mysql-mysql-5.5.35.t15
cmake -DDEFAULT_CHARSET=utf8 -DCMAKE_INSTALL_PREFIX=/gainet/server/mysql5.5.35.t15 -DDEFAULT_COLLATION=utf8_general_ci


make && make install
chown -R mysql:mysql /gainet/server/mysql5.5.35.t15

ln -s /gainet/server/mysql5.5.35.t15 /gainet/server/mysql

echo 'export PATH=/gainet/server/mysql/bin:$PATH' >> /etc/profile

source /etc/profile


sed -i 's@^datadir@#datadir@' /etc/my.cnf
sed -i 's@^socket@#socket@' /etc/my.cnf




#mysql
/gainet/server/mysql/scripts/mysql_install_db --basedir=/gainet/server/mysql --datadir=/opt/template/mysql --user=mysqld69

/gainet/server/mysql/bin/mysqld_multi --defaults-extra-file=/etc/mysql/conf.d/mysqld69.cnf report 60



[mysqld60]
skip-name-resolve
symbolic-links = 0
innodb_log_file_size = 128M
innodb_log_files_in_group = 1
innodb_file_per_table = 1
expire_logs_days = 1
default-storage-engine = MyISAM
replicate-wild-ignore-table = mysql.%
user = mysql
bind-address = 0.0.0.0
long_query_time = 2
port = 5001
datadir = /mysqldata/data60/mysql
max_connections = 60
binlog_cache_size = 240K
read_buffer_size = 240K
read_rnd_buffer_size = 240K
sort_buffer_size = 240K
key_buffer_size = 15M
join_buffer_size = 240K
tmp_table_size = 240K
innodb_additional_mem_pool_size = 1920K
innodb_log_buffer_size = 960K
thread_stack = 240K
innodb_buffer_pool_size = 180M
socket = /tmp/mysql60.sock
innodb_flush_log_at_trx_commit = 1
sync_binlog = 1
log-bin = mysql60-bin
log-bin-index = mysql60-bin.index
server-id = 60