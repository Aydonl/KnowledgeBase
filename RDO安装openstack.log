环境：
操作系统：CentOS6.5 amd64

目标系统：OpenStack Havana Release + Open vSwitch + GRE

网络环境：

192.168.100.0/24：负责外网流量
172.16.0.0/24：负责管理流量
172.16.1.0/24：负责隧道流量

计划部署3台服务器：

（1）Controller：Nova、Neutron、Keystone、Cinder、Glance、Nagios

hostname: h.ctrl

ip-eth0: 192.168.100.170

ip-eth1: 172.16.0.1

ip-eth2: 172.16.1.1

（2）Network：NeutronAgents

hostname: h.network

ip-eth0: 192.168.100.171

ip-eth1: 172.16.0.2

ip-eth2: 172.16.1.2

（3）Compute：Nova-compute，Neutron-L2-Agent

hostname: h.computer

ip-eth0: 192.168.100.172

ip-eth1: 172.16.0.3

ip-eth2: 172.16.1.3

系统初始化配置：
ip配置
按照上述ip规划进行配置。
配置hosts文件
echo -e '172.16.0.1 h.ctrl\n172.16.0.2 h.network\n172.16.0.3 h.computer' >> /etc/hosts
配置DNS服务器
echo 'nameserver 8.8.8.8' >> /etc/resolv.conf
关闭防火墙
service iptables stop
关闭selinux
sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config
打开路由转发
sed -i 's/net.ipv4.ip_forward = 0/net.ipv4.ip_forward = 1/' /etc/sysctl.conf
导入epel软件源
rpm -ivh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
安装rdo
yum install -y http://rdo.fedorapeople.org/openstack/openstack-havana/rdo-release-havana.rpm
yum -y update

-----------------------------

在控制节点上执行
yum install -y openstack-packstack
packstack --gen-answer-file my_answers.txt

# 安装Compute节点

CONFIG_NOVA_COMPUTE_HOSTS=172.16.0.3

# 开启GRE隧道（暂时RDO还不支持直接部署VxLAN）

CONFIG_NEUTRON_OVS_TENANT_NETWORK_TYPE=gre

# 配置隧道ID范围，映射到租户

CONFIG_NEUTRON_OVS_TUNNEL_RANGES=1:10000

# 配置隧道通讯网卡，一般建议独占

CONFIG_NEUTRON_OVS_TUNNEL_IF=eth2

# 配置网络节点

CONFIG_NEUTRON_DHCP_HOSTS=172.16.0.2

CONFIG_NEUTRON_L3_HOSTS=172.16.0.2

CONFIG_NEUTRON_LBAAS_HOSTS=172.16.0.2

CONFIG_NEUTRON_METADATA_HOSTS=172.16.0.2


----
在网络节点上
设置mtu
sed -i '/# dnsmasq_config_file/a\dnsmasq_config_file = /etc/neutron/dnsmasq-neutron.conf' /etc/neutron/dhcp_agent.ini
echo 'dhcp-option-force=26,1400' >> /etc/neutron/dnsmasq-neutron.conf
service neutron-dhcp-agent restart

 网桥配置
需要手动配置一次OVS网桥

将eth0外网网卡配置复制到br-ex，同时清除eth0的配置信息。

/etc/sysconfig/network-scripts/ifcfg-br-ex

/etc/sysconfig/network-scripts/ifcfg-eth0

添加br-ex、br-int网桥设备，将eth0绑定到网桥上。

# ovs-vsctl add-br br-ex

# ovs-vsctl add-port br-ex eth0

# ovs-vsctl add-br br-int

# service network restart



----------
部署完成
访问http://192.168.100.170
用户名、密码在/root/keystonerc_admin文件中

测试镜像
在控制节点上
$ mkdir /tmp/images
$ cd /tmp/images/
$ wget http://cdn.download.cirros-cloud.net/0.3.2/cirros-0.3.2-x86_64-disk.img
$ source /root/keystonerc_admin
$ glance image-create --name "cirros-0.3.2-x86_64" --disk-format qcow2 \
  --container-format bare --is-public True --progress < cirros-0.3.2-x86_64-disk.img
  默认用户名、密码
  user:cirros
  passwd:cubswin:)